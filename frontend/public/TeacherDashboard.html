<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Dashboard - ExamTrack</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
--primary-color: #3498db;
--secondary-color: #2980b9;
--success-color: #27ae60;
--warning-color: #e67e22;
--danger-color: #e74c3c;
--light-gray: #f5f5f5;
--medium-gray: #e0e0e0;
--dark-gray: #333;
--text-color: #333;
--sidebar-width: 250px;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background-color: #f8f9fa;
color: var(--text-color);
}

.container {
display: flex;
min-height: 100vh;
}

.sidebar {
width: var(--sidebar-width);
background-color: #2c3e50;
color: white;
padding: 20px 0;
position: fixed;
height: 100vh;
overflow-y: auto;
}

.sidebar-header {
padding: 0 20px 20px 20px;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
text-align: center;
}

.teacher-portal {
color: #f1c40f;
font-size: 14px;
margin-top: 2px;
}

.logo {
font-size: 24px;
font-weight: bold;
margin-bottom: 5px;
color: white;
}

.nav-menu {
list-style: none;
padding: 20px 0;
}

.nav-item {
padding: 10px 20px;
cursor: pointer;
display: flex;
align-items: center;
transition: all 0.3s;
}

.nav-item:hover, .nav-item.active {
background-color: rgba(255, 255, 255, 0.1);
}

.nav-item i {
margin-right: 10px;
font-size: 18px;
}

.main-content {
flex: 1;
margin-left: var(--sidebar-width);
padding: 20px;
}

.header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 20px;
background-color: white;
border-radius: 10px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
margin-bottom: 20px;
}

.teacher-info {
display: flex;
flex-direction: column;
}

.teacher-name {
font-size: 20px;
font-weight: bold;
}

.teacher-details {
color: #666;
margin-top: 5px;
}

.logout-btn {
background-color: var(--danger-color);
color: white;
border: none;
padding: 8px 15px;
border-radius: 5px;
cursor: pointer;
display: flex;
align-items: center;
}
.logout-btn a {
color: white;
text-decoration: none;
}

.logout-btn i {
margin-right: 5px;
}

.dashboard-summary {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
gap: 20px;
margin-bottom: 20px;
}

.summary-card {
background-color: white;
border-radius: 10px;
padding: 20px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
display: flex;
align-items: center;
}

.card-icon {
width: 50px;
height: 50px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
margin-right: 15px;
font-size: 20px;
}

.card-primary {
background-color: rgba(52, 152, 219, 0.2);
color: var(--primary-color);
}

.card-success {
background-color: rgba(39, 174, 96, 0.2);
color: var(--success-color);
}

.card-warning {
background-color: rgba(230, 126, 34, 0.2);
color: var(--warning-color);
}

.card-danger {
background-color: rgba(231, 76, 60, 0.2);
color: var(--danger-color);
}

.card-info {
display: flex;
flex-direction: column;
}

.card-value {
font-size: 24px;
font-weight: bold;
}

.card-label {
color: #666;
font-size: 14px;
}

.section {
background-color: white;
border-radius: 10px;
padding: 20px;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
margin-bottom: 20px;
}

.section-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.section-title {
font-size: 18px;
font-weight: bold;
}

.section-actions {
display: flex;
gap: 10px;
}

.dropdown-filter {
padding: 8px;
border-radius: 5px;
border: 1px solid var(--medium-gray);
}

.search-box {
padding: 8px;
border-radius: 5px;
border: 1px solid var(--medium-gray);
}

.data-table {
width: 100%;
border-collapse: collapse;
}

.data-table th, .data-table td {
padding: 12px 15px;
text-align: left;
border-bottom: 1px solid var(--medium-gray);
}

.data-table th {
background-color: var(--light-gray);
font-weight: 600;
}

.data-table tr:hover {
background-color: rgba(0, 0, 0, 0.02);
}

.grade-input {
width: 80px;
padding: 6px;
border: 1px solid var(--medium-gray);
border-radius: 4px;
text-align: center;
}

.status-badge {
padding: 5px 10px;
border-radius: 20px;
font-size: 14px;
font-weight: 500;
display: inline-block;
text-align: center;
min-width: 80px;
}

.badge-success {
background-color: rgba(39, 174, 96, 0.2);
color: var(--success-color);
}

.badge-warning {
background-color: rgba(230, 126, 34, 0.2);
color: var(--warning-color);
}

.badge-danger {
background-color: rgba(231, 76, 60, 0.2);
color: var(--danger-color);
}

.badge-primary {
background-color: rgba(52, 152, 219, 0.2);
color: var(--primary-color);
}

.btn {
padding: 8px 15px;
border-radius: 5px;
border: none;
cursor: pointer;
font-weight: 500;
display: inline-flex;
align-items: center;
justify-content: center;
gap: 5px;
}

.btn-primary {
background-color: var(--primary-color);
color: white;
}

.btn-success {
background-color: var(--success-color);
color: white;
}

.btn-warning {
background-color: var(--warning-color);
color: white;
}

.btn-danger {
background-color: var(--danger-color);
color: white;
}

.btn-icon {
background: none;
border: none;
cursor: pointer;
font-size: 16px;
padding: 5px;
color: var(--dark-gray);
}

.text-center {
text-align: center;
}

.text-success {
color: var(--success-color);
}

.text-warning {
color: var(--warning-color);
}

.text-danger {
color: var(--danger-color);
}

.modal {
display: none;
position: fixed;
z-index: 1000;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
background-color: white;
margin: 5% auto;
padding: 20px;
border-radius: 10px;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
width: 70%;
max-width: 800px;
max-height: 80vh;
overflow-y: auto;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
border-bottom: 1px solid var(--medium-gray);
padding-bottom: 15px;
margin-bottom: 15px;
}

.modal-title {
font-size: 20px;
font-weight: bold;
}

.close-btn {
cursor: pointer;
font-size: 24px;
font-weight: bold;
}

.form-group {
margin-bottom: 15px;
}

.form-group label {
display: block;
margin-bottom: 5px;
font-weight: 500;
}

.form-control {
width: 100%;
padding: 8px;
border: 1px solid var(--medium-gray);
border-radius: 5px;
}

.form-actions {
display: flex;
justify-content: flex-end;
gap: 10px;
margin-top: 20px;
}

.filiere-selector {
position: relative;
margin: 15px 20px;
border-top: 1px solid rgba(255, 255, 255, 0.1);
padding-top: 15px;
}

.filiere-label {
display: block;
color: rgba(255, 255, 255, 0.6);
font-size: 12px;
margin-bottom: 5px;
}

.filiere-dropdown {
width: 100%;
padding: 8px 10px;
background-color: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
border-radius: 5px;
color: white;
cursor: pointer;
}

.filiere-list {
list-style: none;
margin-top: 10px;
}

.filiere-item {
padding: 8px 15px 8px 30px;
cursor: pointer;
transition: all 0.2s;
}

.filiere-item:hover {
background-color: rgba(255, 255, 255, 0.1);
}

.page {
display: none;
}

.page.active {
display: block;
}

.tab-header {
display: flex;
border-bottom: 1px solid var(--medium-gray);
margin-bottom: 20px;
}

.tab-item {
padding: 10px 20px;
cursor: pointer;
border-bottom: 2px solid transparent;
}

.tab-item.active {
border-bottom-color: var(--primary-color);
color: var(--primary-color);
font-weight: bold;
}

.question-container {
border: 1px solid var(--medium-gray);
border-radius: 5px;
padding: 15px;
margin-bottom: 15px;
}

.grade-saved {
animation: highlight 1s ease-out;
}

@keyframes highlight {
0% { background-color: rgba(39, 174, 96, 0.4); }
100% { background-color: transparent; }
}
</style>
</head>
<body>
<div class="container">
<!-- Sidebar Navigation -->
<div class="sidebar">
<div class="sidebar-header">
<div class="logo">ExamTrack</div>
<div class="teacher-portal">Teacher Portal</div>
</div>

<!-- Filiere Selector -->
<div class="filiere-selector">
<label class="filiere-label">Current Program/Track</label>
<select id="filiere-select" class="filiere-dropdown" onchange="changeFiliere()">
<option value="all">All Programs</option>
<option value="cs">Computer Science</option>
<option value="engineering">Engineering</option>
<option value="business">Business Administration</option>
<option value="medicine">Medicine</option>
</select>
</div>

<!-- Navigation Menu -->
<ul class="nav-menu">
<li class="nav-item active" onclick="showPage('dashboard')">
<i class="fas fa-tachometer-alt"></i> Dashboard
</li>
<li class="nav-item" onclick="showPage('students')">
<i class="fas fa-user-graduate"></i> Students
</li>
<li class="nav-item" onclick="showPage('exams')">
<i class="fas fa-file-alt"></i> Exams
</li>
<li class="nav-item" onclick="showPage('grades')">
<i class="fas fa-chart-bar"></i> Grades
</li>
<li class="nav-item" onclick="showPage('create-exam')">
<i class="fas fa-plus-circle"></i> Create Exam
</li>
<li class="nav-item" onclick="showPage('filieres')">
<i class="fas fa-graduation-cap"></i> Programs/Tracks
</li>
<li class="nav-item" onclick="showPage('settings')">
<i class="fas fa-cog"></i> Settings
</li>
</ul>
</div>

<!-- Main Content -->
<div class="main-content">
<!-- Header Bar -->
<div class="header">
<div class="teacher-info">
<div class="teacher-name">Dr. Sarah Johnson</div>
<div class="teacher-details">Professor of Computer Science</div>
</div>
<button class="logout-btn">
<a href="../public/login.html"><i class="fas fa-sign-out-alt"></i>Logout</a>
</button>
</div>

<!-- Dashboard Page -->
<div id="dashboard" class="page active">
<div class="dashboard-summary">
<div class="summary-card">
<div class="card-icon card-primary">
<i class="fas fa-user-graduate"></i>
</div>
<div class="card-info">
<div class="card-value" id="total-students-count">--</div>
<div class="card-label">Total Students</div>
</div>
</div>
<div class="summary-card">
<div class="card-icon card-success">
<i class="fas fa-file-alt"></i>
</div>
<div class="card-info">
<div class="card-value" id="active-exams-count">--</div>
<div class="card-label">Active Exams</div>
</div>
</div>
<div class="summary-card">
<div class="card-icon card-warning">
<i class="fas fa-clock"></i>
</div>
<div class="card-info">
<div class="card-value" id="upcoming-exams-count">--</div>
<div class="card-label">Upcoming Exams</div>
</div>
</div>
<div class="summary-card">
<div class="card-icon card-danger">
<i class="fas fa-exclamation-circle"></i>
</div>
<div class="card-info">
<div class="card-value" id="pending-grades-count">--</div>
<div class="card-label">Pending Grades</div>
</div>
</div>
</div>

<div class="section">
<div class="section-header">
<div class="section-title">Recent Exams</div>
<div class="section-actions">
<select class="dropdown-filter">
<option>All Programs</option>
<option>Computer Science</option>
<option>Engineering</option>
<option>Business Administration</option>
<option>Medicine</option>
</select>
</div>
</div>
<table class="data-table">
<thead>
<tr>
<th>Exam Title</th>
<th>Program</th>
<th>Date</th>
<th>Status</th>
<th>Students</th>
<th>Avg. Grade</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="recent-exams-table-body">
<!-- Data will be loaded from database -->
</tbody>
</table>
</div>
</div>

<!-- Grades Page -->
<div id="grades" class="page">
<div class="section">
<div class="section-header">
<div class="section-title">Student Grades</div>
<div class="section-actions">
<select class="dropdown-filter" id="grades-filiere-filter" onchange="filterGradesByFiliere()">
<option value="all">All Programs</option>
<option value="cs">Computer Science</option>
<option value="engineering">Engineering</option>
<option value="business">Business Administration</option>
<option value="medicine">Medicine</option>
</select>
<select class="dropdown-filter" id="grades-exam-filter">
<option value="all">All Exams</option>
<option value="midterm">Midterms</option>
<option value="final">Finals</option>
<option value="quiz">Quizzes</option>
</select>
<input type="text" class="search-box" placeholder="Search students...">
</div>
</div>
<table class="data-table">
<thead>
<tr>
<th>Student ID</th>
<th>Student Name</th>
<th>Program</th>
<th>Exam</th>
<th>Date</th>
<th>Grade</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="grades-table-body">
<!-- Data will be loaded from database -->
</tbody>
</table>
</div>
</div>

<!-- Create Exam Page -->
<div id="create-exam" class="page">
<div class="section">
<div class="section-header">
<div class="section-title">Create New Exam</div>
</div>
<form id="exam-form">
<div class="form-group">
<label for="exam-title">Exam Title</label>
<input type="text" id="exam-title" class="form-control" required>
</div>
<div class="form-group">
<label for="exam-description">Description</label>
<textarea id="exam-description" class="form-control" rows="3"></textarea>
</div>
<div class="form-group">
<label for="exam-filiere">Program/Track</label>
<select id="exam-filiere" class="form-control" required>
<option value="">Select Program</option>
<!-- Options will be loaded from database -->
</select>
</div>
<div class="form-group">
<label for="exam-date">Exam Date</label>
<input type="date" id="exam-date" class="form-control" required>
</div>
<div class="form-group">
<label for="exam-time">Exam Time</label>
<input type="time" id="exam-time" class="form-control" required>
</div>
<div class="form-group">
<label for="exam-duration">Duration (minutes)</label>
<input type="number" id="exam-duration" class="form-control" min="15" required>
</div>
<div class="form-group">
<label for="exam-type">Exam Type</label>
<select id="exam-type" class="form-control" required>
<option value="midterm">Midterm</option>
<option value="final">Final</option>
<option value="quiz">Quiz</option>
<option value="assignment">Assignment</option>
</select>
</div>

<div class="tab-header">
<div class="tab-item active" onclick="switchTab('multiple-choice')">Multiple Choice</div>
<div class="tab-item" onclick="switchTab('essay')">Essay Questions</div>
<div class="tab-item" onclick="switchTab('true-false')">True/False</div>
</div>

<div id="multiple-choice-tab" class="tab-content active">
<button type="button" class="btn btn-primary" onclick="addMultipleChoiceQuestion()">
<i class="fas fa-plus"></i> Add Question
</button>
<div id="multiple-choice-questions">
<!-- Questions will be added dynamically -->
</div>
</div>

<div id="essay-tab" class="tab-content">
<button type="button" class="btn btn-primary" onclick="addEssayQuestion()">
<i class="fas fa-plus"></i> Add Question
</button>
<div id="essay-questions">
<!-- Questions will be added dynamically -->
</div>
</div>

<div id="true-false-tab" class="tab-content">
<button type="button" class="btn btn-primary" onclick="addTrueFalseQuestion()">
<i class="fas fa-plus"></i> Add Question
</button>
<div id="true-false-questions">
<!-- Questions will be added dynamically -->
</div>
</div>

<div class="form-actions">
<button type="button" class="btn btn-danger" onclick="showPage('exams')">Cancel</button>
<button type="submit" class="btn btn-success">Create Exam</button>
</div>
</form>
</div>
</div>

<!-- Filieres (Programs/Tracks) Page -->
<div id="filieres" class="page">
<div class="section">
<div class="section-header">
<div class="section-title">Programs/Tracks</div>
<div class="section-actions">
<button class="btn btn-primary" onclick="openModal('add-filiere-modal')">
<i class="fas fa-plus"></i> Add Program
</button>
</div>
</div>
<div class="dashboard-summary">
<div id="filiere-cards-container">
<!-- Program cards will be loaded from database -->
</div>
</div>

<div class="section-header">
<div class="section-title">Your Assigned Programs</div>
</div>
<table class="data-table">
<thead>
<tr>
<th>Program Code</th>
<th>Program Name</th>
<th>Department</th>
<th>Students</th>
<th>Courses</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="filieres-table-body">
<!-- Data will be loaded from database -->
</tbody>
</table>
</div>
</div>

<!-- Students Page -->
<div id="students" class="page">
<div class="section">
<div class="section-header">
<div class="section-title">Students</div>
<div class="section-actions">
<select class="dropdown-filter" id="students-filiere-filter">
<option value="all">All Programs</option>
<option value="cs">Computer Science</option>
<option value="engineering">Engineering</option>
<option value="business">Business Administration</option>
<option value="medicine">Medicine</option>
</select>
<input type="text" class="search-box" placeholder="Search students...">
<button class="btn btn-primary" onclick="openModal('add-student-modal')">
<i class="fas fa-plus"></i> Add Student
</button>
</div>
</div>
<table class="data-table">
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Program</th>
<th>Email</th>
<th>Status</th>
<th>Grade Avg.</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="students-table-body">
<!-- Data will be loaded from database -->
</tbody>
</table>
</div>
</div>

<!-- Exams Page -->
<div id="exams" class="page">
<div class="section">
<div class="section-header">
<div class="section-title">Exams</div>
<div class="section-actions">
<select class="dropdown-filter" id="exams-filiere-filter">
<option value="all">All Programs</option>
<option value="cs">Computer Science</option>
<option value="engineering">Engineering</option>
<option value="business">Business Administration</option>
<option value="medicine">Medicine</option>
</select>
<select class="dropdown-filter">
<option>All Status</option>
<option>Scheduled</option>
<option>In Progress</option>
<option>Completed</option>
<option>Grading</option>
</select>
<input type="text" class="search-box" placeholder="Search exams...">
<button class="btn btn-primary" onclick="showPage('create-exam')">
<i class="fas fa-plus"></i> Create Exam
</button>
</div>
</div>
<table class="data-table">
<thead>
<tr>
<th>Exam Title</th>
<th>Program</th>
<th>Date</th>
<th>Duration</th>
<th>Status</th>
<th>Students</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="exams-table-body">
<!-- Data will be loaded from database -->
</tbody>
</table>
</div>
</div>
</div>
</div>

<script>
// JavaScript code here
document.addEventListener('DOMContentLoaded', function() {
// Initialize dashboard data and event listeners
loadDashboardSummary();
loadExamTable();
loadStudentTable();
loadFiliereData();
loadGradesTable();
setupEventListeners();
initFormHandlers();
});

// Dashboard data loading
function loadDashboardSummary() {
// Fetch summary data via AJAX
fetch('/api/dashboard/summary')
.then(response => response.json())
.then(data => {
document.getElementById('total-students-count').textContent = data.studentCount;
document.getElementById('active-exams-count').textContent = data.activeExamsCount;
document.getElementById('upcoming-exams-count').textContent = data.upcomingExamsCount;
document.getElementById('pending-grades-count').textContent = data.pendingGradesCount;
})
.catch(error => {
console.error('Error loading dashboard summary:', error);
// Set fallback values for demo
// document.getElementById('total-students-count').textContent = '30';
// document.getElementById('active-exams-count').textContent = '3';
// document.getElementById('upcoming-exams-count').textContent = '5';
// document.getElementById('pending-grades-count').textContent = '--';
});
}

// Load exams data
function loadExamTable(filterFiliere = 'all') {
const tableBody = document.getElementById('exams-table-body');
const endpoint = filterFiliere === 'all' ?
'/api/exams' :
`/api/exams?filiere=${encodeURIComponent(filterFiliere)}`;

fetch(endpoint)
.then(response => response.json())
.then(exams => {
tableBody.innerHTML = '';

if (exams.length === 0) {
const emptyRow = document.createElement('tr');
emptyRow.innerHTML = `<td colspan="7" class="text-center">No exams found</td>`;
tableBody.appendChild(emptyRow);
return;
}

exams.forEach(exam => {
const row = document.createElement('tr');

// Determine status badge class
let statusClass = '';
switch(exam.status) {
case 'Completed': statusClass = 'badge-success'; break;
case 'In Progress': statusClass = 'badge-warning'; break;
case 'Scheduled': statusClass = 'badge-primary'; break;
case 'Grading': statusClass = 'badge-primary'; break;
default: statusClass = 'badge-primary';
}

row.innerHTML = `
<td>${exam.title}</td>
<td>${exam.filiere}</td>
<td>${formatDate(exam.date)}</td>
<td>${exam.duration} mins</td>
<td><span class="status-badge ${statusClass}">${exam.status}</span></td>
<td>${exam.studentCount}</td>
<td>
<button class="btn-icon" title="View Details" onclick="viewExamDetails(${exam.id})">
<i class="fas fa-eye"></i>
</button>
<button class="btn-icon" title="Edit Exam" onclick="editExam(${exam.id})">
<i class="fas fa-edit"></i>
</button>
<button class="btn-icon" title="View Grades" onclick="viewExamGrades(${exam.id})">
<i class="fas fa-chart-line"></i>
</button>
</td>
`;

tableBody.appendChild(row);
});
})
.catch(error => {
console.error('Error loading exams:', error);
// Show mock data for demo purposes
//loadMockExamData(tableBody);
});
}

// Load students data
function loadStudentTable(filterFiliere = 'all') {
const tableBody = document.getElementById('students-table-body');
const endpoint = filterFiliere === 'all' ?
'/api/students' :
`/api/students?filiere=${encodeURIComponent(filterFiliere)}`;

fetch(endpoint).then(response => response.json()).then(students => {
tableBody.innerHTML = '';

if (students.length === 0) {
const emptyRow = document.createElement('tr');
emptyRow.innerHTML = `<td colspan="7" class="text-center">No students found</td>`;
tableBody.appendChild(emptyRow);
return;
}

students.forEach(student => {
const row = document.createElement('tr');

// Determine status badge class
let statusClass = '';
switch(student.status) {
case 'Active': statusClass = 'badge-success'; break;
case 'On Leave': statusClass = 'badge-warning'; break;
case 'Inactive': statusClass = 'badge-danger'; break;
default: statusClass = 'badge-primary';
}

row.innerHTML = `
<td>${student.id}</td>
<td>${student.nom} ${student.prenom}</td>
<td>${student.filiere}</td>
<td>${student.email}</td>
<td><span class="status-badge ${statusClass}">${student.status}</span></td>
<td>${student.gradeAvg}%</td>
<td>
<button class="btn-icon" title="View Details" onclick="viewStudentDetails(${student.id})">
<i class="fas fa-eye"></i>
</button>
<button class="btn-icon" title="Edit Student" onclick="editStudent(${student.id})">
<i class="fas fa-edit"></i>
</button>
<button class="btn-icon" title="View Grades" onclick="viewStudentGrades(${student.id})">
<i class="fas fa-chart-line"></i>
</button>
</td>
`;

tableBody.appendChild(row);
});
})
.catch(error => {
console.error('Error loading students:', error);
// Load mock data for demonstration
//loadMockStudentData(tableBody);
});
};
// Load grades data
function loadGradesTable(filterOptions = {}) {
const tableBody = document.getElementById('grades-table-body');

// Construct query parameters
const params = new URLSearchParams();
if (filterOptions.filiere && filterOptions.filiere !== 'all') {
params.append('filiere', filterOptions.filiere);
}
if (filterOptions.examType && filterOptions.examType !== 'all') {
params.append('examType', filterOptions.examType);
}
if (filterOptions.search) {
params.append('search', filterOptions.search);
}

const endpoint = `/api/grades?${params.toString()}`;

fetch(endpoint)
.then(response => response.json())
.then(grades => {
tableBody.innerHTML = '';

if (grades.length === 0) {
const emptyRow = document.createElement('tr');
emptyRow.innerHTML = `<td colspan="8" class="text-center">No grades found</td>`;
tableBody.appendChild(emptyRow);
return;
}

grades.forEach(grade => {
const row = document.createElement('tr');

// Determine status class
let statusClass = '';
if (grade.score >= 90) statusClass = 'text-success';
else if (grade.score >= 70) statusClass = 'text-primary';
else if (grade.score >= 50) statusClass = 'text-warning';
else statusClass = 'text-danger';

row.innerHTML = `
<td>${grade.studentId}</td>
<td>${grade.studentName}</td>
<td>${grade.filiere}</td>
<td>${grade.examTitle}</td>
<td>${formatDate(grade.examDate)}</td>
<td>
<input type="number" class="grade-input" value="${grade.score}"
min="0" max="100" data-student-id="${grade.studentId}"
data-exam-id="${grade.examId}" onchange="saveGrade(this)">
</td>
<td><span class="${statusClass}">${getGradeLabel(grade.score)}</span></td>
<td>
<button class="btn-icon" title="View Details" onclick="viewGradeDetails(${grade.studentId}, ${grade.examId})">
<i class="fas fa-eye"></i>
</button>
</td>
`;

tableBody.appendChild(row);
});
})
.catch(error => {
console.error('Error loading grades:', error);
// Load mock data for demonstration
//loadMockGradeData(tableBody);
});
};
// Load filiere data
function loadFiliereData() {
// Fetch filiere data for dropdowns and filiere page
fetch('/api/filieres')
.then(response => response.json())
.then(filieres => {
populateFiliereDropdowns(filieres);
loadFiliereCards(filieres);
loadFiliereTable(filieres);
})
.catch(error => {
console.error('Error loading filiere data:', error);
// Load mock data for demonstration
/*
const mockFilieres = [
{ id: 1, code: '2IDL', name: 'Computer Science', department: 'Engineering', studentCount: 45, courseCount: 5 },
{ id: 2, code: 'PC', name: 'Engineering', department: 'Engineering', studentCount: 38, courseCount: 6 },
{ id: 3, code: 'BCG', name: 'Biology', department: 'Life Sciences', studentCount: 32, courseCount: 7 }
];
populateFiliereDropdowns(mockFilieres);
loadFiliereCards(mockFilieres);
loadFiliereTable(mockFilieres);
*/
});
}

// Populate all filiere dropdowns
function populateFiliereDropdowns(filieres) {
const dropdowns = [
document.getElementById('filiere-select'),
document.getElementById('grades-filiere-filter'),
document.getElementById('students-filiere-filter'),
document.getElementById('exams-filiere-filter'),
document.getElementById('exam-filiere')
];

dropdowns.forEach(dropdown => {
if (!dropdown) return;

// Keep the first option (All Programs) and remove the rest
const firstOption = dropdown.id === 'exam-filiere' ?
'<option value="">Select Program</option>' :
'<option value="all">All Programs</option>';

dropdown.innerHTML = firstOption;

// Add options for each filiere
filieres.forEach(filiere => {
const option = document.createElement('option');
option.value = filiere.code.toLowerCase();
option.textContent = filiere.name;
dropdown.appendChild(option);
});
});
}

// Load filiere cards for the filieres page
function loadFiliereCards(filieres) {
const container = document.getElementById('filiere-cards-container');
if (!container) return;

container.innerHTML = '';

filieres.forEach(filiere => {
const card = document.createElement('div');
card.className = 'summary-card';
card.innerHTML = `
<div class="card-icon card-primary">
<i class="fas fa-graduation-cap"></i>
</div>
<div class="card-info">
<div class="card-value">${filiere.name}</div>
<div class="card-label">${filiere.studentCount} students</div>
</div>
`;
container.appendChild(card);
});
}

// Load filiere table for the filieres page
function loadFiliereTable(filieres) {
const tableBody = document.getElementById('filieres-table-body');
if (!tableBody) return;

tableBody.innerHTML = '';

filieres.forEach(filiere => {
const row = document.createElement('tr');
row.innerHTML = `
<td>${filiere.code}</td>
<td>${filiere.name}</td>
<td>${filiere.department}</td>
<td>${filiere.studentCount}</td>
<td>${filiere.courseCount}</td>
<td>
<button class="btn-icon" title="View Details" onclick="viewFiliereDetails(${filiere.id})">
<i class="fas fa-eye"></i>
</button>
<button class="btn-icon" title="Edit Program" onclick="editFiliere(${filiere.id})">
<i class="fas fa-edit"></i>
</button>
</td>
`;
tableBody.appendChild(row);
});
}

// Event Listeners
function setupEventListeners() {
// Filiere filter change events
const filiereSelectors = [
{ id: 'filiere-select', handler: changeFiliere },
{ id: 'students-filiere-filter', handler: () => filterStudentsByFiliere() },
{ id: 'exams-filiere-filter', handler: () => filterExamsByFiliere() },
{ id: 'grades-filiere-filter', handler: () => filterGradesByFiliere() }
];

filiereSelectors.forEach(selector => {
const element = document.getElementById(selector.id);
if (element) {
element.addEventListener('change', selector.handler);
}
});

// Search input events
document.querySelectorAll('.search-box').forEach(searchBox => {
searchBox.addEventListener('input', debounce(function() {
const section = searchBox.closest('.section');
if (section.querySelector('.data-table')) {
const tableId = section.querySelector('.data-table tbody').id;

if (tableId === 'students-table-body') {
filterStudentsByName(searchBox.value);
} else if (tableId === 'exams-table-body') {
filterExamsByTitle(searchBox.value);
} else if (tableId === 'grades-table-body') {
filterGradesByStudent(searchBox.value);
}
}
}, 300));
});
}

// Form handler initialization
function initFormHandlers() {
// Exam form submission
const examForm = document.getElementById('exam-form');
if (examForm) {
examForm.addEventListener('submit', function(e) {
e.preventDefault();
createExam();
});
}
}

// Create a new exam
function createExam() {
const formData = {
title: document.getElementById('exam-title').value,
description: document.getElementById('exam-description').value,
filiere: document.getElementById('exam-filiere').value,
date: document.getElementById('exam-date').value,
time: document.getElementById('exam-time').value,
duration: document.getElementById('exam-duration').value,
type: document.getElementById('exam-type').value,
questions: collectQuestionsData()
};

fetch('/api/exams', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(formData)
})
.then(response => response.json())
.then(data => {
if (data.success) {
alert('Exam created successfully!');
showPage('exams');
loadExamTable();
} else {
alert('Error creating exam: ' + data.message);
}
})
.catch(error => {
console.error('Error creating exam:', error);
alert('Error creating exam. Please try again.');
});
}

// Collect questions data from the form
function collectQuestionsData() {
const questions = [];

// Multiple choice questions
document.querySelectorAll('#multiple-choice-questions .question-container').forEach(container => {
const questionText = container.querySelector('.question-text').value;
const points = container.querySelector('.question-points').value;
const options = [];

container.querySelectorAll('.option-item').forEach(item => {
options.push({
text: item.querySelector('.option-text').value,
isCorrect: item.querySelector('.option-correct').checked
});
});

questions.push({
type: 'multiple-choice',
text: questionText,
points: points,
options: options
});
});

// Essay questions
document.querySelectorAll('#essay-questions .question-container').forEach(container => {
questions.push({
type: 'essay',
text: container.querySelector('.question-text').value,
points: container.querySelector('.question-points').value,
expectedLength: container.querySelector('.expected-length').value
});
});

// True/False questions
document.querySelectorAll('#true-false-questions .question-container').forEach(container => {
questions.push({
type: 'true-false',
text: container.querySelector('.question-text').value,
points: container.querySelector('.question-points').value,
correctAnswer: container.querySelector('.correct-answer').value
});
});

return questions;
}

// Save a grade
function saveGrade(input) {
const studentId = input.dataset.studentId;
const examId = input.dataset.examId;
const score = input.value;

fetch('/api/grades', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({
studentId: studentId,
examId: examId,
score: score
})
})
.then(response => response.json())
.then(data => {
if (data.success) {
// Highlight the saved grade
input.classList.add('grade-saved');
setTimeout(() => {
input.classList.remove('grade-saved');
}, 1000);

// Update the status cell
const statusCell = input.parentElement.nextElementSibling;
let statusClass = '';
if (score >= 90) statusClass = 'text-success';
else if (score >= 70) statusClass = 'text-primary';
else if (score >= 50) statusClass = 'text-warning';
else statusClass = 'text-danger';

statusCell.innerHTML = `<span class="${statusClass}">${getGradeLabel(score)}</span>`;
} else {
alert('Error saving grade: ' + data.message);
}
})
.catch(error => {
console.error('Error saving grade:', error);
alert('Error saving grade. Please try again.');
});
}

// Page navigation
function showPage(pageId) {
// Hide all pages
document.querySelectorAll('.page').forEach(page => {
page.classList.remove('active');
});

// Show the selected page
document.getElementById(pageId).classList.add('active');

// Update active state in navigation
document.querySelectorAll('.nav-item').forEach(item => {
item.classList.remove('active');
});

document.querySelector(`.nav-item[onclick="showPage('${pageId}')"]`).classList.add('active');

// Load page-specific data
switch(pageId) {
case 'dashboard':
loadDashboardSummary();
break;
case 'students':
loadStudentTable();
break;
case 'exams':
loadExamTable();
break;
case 'grades':
loadGradesTable();
break;
case 'filieres':
loadFiliereData();
break;
}
}

// Filter functions
function changeFiliere() {
const filiere = document.getElementById('filiere-select').value;
// Update all data based on selected filiere
loadDashboardSummary(filiere);
loadExamTable(filiere);
}

function filterStudentsByFiliere() {
const filiere = document.getElementById('students-filiere-filter').value;
loadStudentTable(filiere);
}

function filterExamsByFiliere() {
const filiere = document.getElementById('exams-filiere-filter').value;
loadExamTable(filiere);
}

function filterGradesByFiliere() {
const filiere = document.getElementById('grades-filiere-filter').value;
const examType = document.getElementById('grades-exam-filter').value;
const searchInput = document.querySelector('#grades .search-box').value;

loadGradesTable({
filiere: filiere,
examType: examType,
search: searchInput
});
}

function filterStudentsByName(name) {
const filiere = document.getElementById('students-filiere-filter').value;
const tableBody = document.getElementById('students-table-body');

// Filter students by name
fetch(`/api/students?filiere=${encodeURIComponent(filiere)}&name=${encodeURIComponent(name)}`)
.then(response => response.json())
.then(students => {
// Update table with filtered students
updateStudentTable(students, tableBody);
})
.catch(error => {
console.error('Error filtering students:', error);
// For demonstration, filter the mock data
/*
const mockStudents = getMockStudents();
const filteredStudents = mockStudents.filter(student =>
`${student.nom} ${student.prenom}`.toLowerCase().includes(name.toLowerCase())
);
updateStudentTable(filteredStudents, tableBody);
*/
});
}

function filterExamsByTitle(title) {
const filiere = document.getElementById('exams-filiere-filter').value;
const tableBody = document.getElementById('exams-table-body');

// Filter exams by title
fetch(`/api/exams?filiere=${encodeURIComponent(filiere)}&title=${encodeURIComponent(title)}`)
.then(response => response.json())
.then(exams => {
// Update table with filtered exams
updateExamTable(exams, tableBody);
})
.catch(error => {
console.error('Error filtering exams:', error);
// For demonstration, filter the mock data
/*
const mockExams = getMockExams();
const filteredExams = mockExams.filter(exam =>
exam.title.toLowerCase().includes(title.toLowerCase())
);
updateExamTable(filteredExams, tableBody);
*/
});
}

function filterGradesByStudent(name) {
const filiere = document.getElementById('grades-filiere-filter').value;
const examType = document.getElementById('grades-exam-filter').value;

loadGradesTable({
filiere: filiere,
examType: examType,
search: name
});
}

// Modal functions
function openModal(modalId) {
document.getElementById(modalId).style.display = 'block';
}

function closeModal(modalId) {
document.getElementById(modalId).style.display = 'none';
}

// Question management for exams
function addMultipleChoiceQuestion() {
const container = document.getElementById('multiple-choice-questions');
const questionId = Date.now(); // Using timestamp as unique ID

const questionDiv = document.createElement('div');
questionDiv.className = 'question-container';
questionDiv.innerHTML = `
<div class="form-group">
<label>Question Text</label>
<textarea class="form-control question-text" rows="2" required></textarea>
</div>
<div class="form-group">
<label>Points</label>
<input type="number" class="form-control question-points" min="1" value="1" required>
</div>
<div class="options-container">
<label>Options</label>
<div class="option-list"></div>
<button type="button" class="btn btn-primary" onclick="addOption(this.parentElement)">
<i class="fas fa-plus"></i> Add Option
</button>
</div>
<button type="button" class="btn btn-danger" onclick="removeQuestion(this)">
<i class="fas fa-trash"></i> Remove Question
</button>
`;

container.appendChild(questionDiv);

// Add two default options
const optionList = questionDiv.querySelector('.option-list');
addOptionToList(optionList);
addOptionToList(optionList);
}

function addEssayQuestion() {
const container = document.getElementById('essay-questions');

const questionDiv = document.createElement('div');
questionDiv.className = 'question-container';
questionDiv.innerHTML = `
<div class="form-group">
<label>Question Text</label>
<textarea class="form-control question-text" rows="2" required></textarea>
</div>
<div class="form-group">
<label>Points</label>
<input type="number" class="form-control question-points" min="1" value="5" required>
</div>
<div class="form-group">
<label>Expected Answer Length (words)</label>
<input type="number" class="form-control expected-length" min="10" value="100">
</div>
<button type="button" class="btn btn-danger" onclick="removeQuestion(this)">
<i class="fas fa-trash"></i> Remove Question
</button>
`;

container.appendChild(questionDiv);
}

function addTrueFalseQuestion() {
const container = document.getElementById('true-false-questions');

const questionDiv = document.createElement('div');
questionDiv.className = 'question-container';
questionDiv.innerHTML = `
<div class="form-group">
<label>Question Text</label>
<textarea class="form-control question-text" rows="2" required></textarea>
</div>
<div class="form-group">
<label>Points</label>
<input type="number" class="form-control question-points" min="1" value="1" required>
</div>
<div class="form-group">
<label>Correct Answer</label>
<select class="form-control correct-answer">
<option value="true">True</option>
<option value="false">False</option>
</select>
</div>
<button type="button" class="btn btn-danger" onclick="removeQuestion(this)">
<i class="fas fa-trash"></i> Remove Question
</button>
`;

container.appendChild(questionDiv);
}

function addOption(container) {
const optionList = container.querySelector('.option-list');
addOptionToList(optionList);
}

function addOptionToList(optionList) {
const optionDiv = document.createElement('div');
optionDiv.className = 'form-group option-item';
optionDiv.innerHTML = `
<div style="display: flex; align-items: center; gap: 10px;">
<input type="text" class="form-control option-text" placeholder="Option text" required>
<label style="display: flex; align-items: center; gap: 5px; margin: 0;">
<input type="checkbox" class="option-correct"> Correct
</label>
<button type="button" class="btn-icon" onclick="removeOption(this)" title="Remove Option">
<i class="fas fa-times"></i>
</button>
</div>
`;

optionList.appendChild(optionDiv);
}

function removeQuestion(button) {
const questionContainer = button.closest('.question-container');
questionContainer.remove();
}

function removeOption(button) {
const optionItem = button.closest('.option-item');
optionItem.remove();
}

function switchTab(tabId) {
// Hide all tab contents
document.querySelectorAll('.tab-content').forEach(tab => {
tab.classList.remove('active');
});

// Deactivate all tab headers
document.querySelectorAll('.tab-item').forEach(tab => {
tab.classList.remove('active');
});

// Show selected tab content
document.getElementById(`${tabId}-tab`).classList.add('active');

// Activate selected tab header
document.querySelector(`.tab-item[onclick="switchTab('${tabId}')"]`).classList.add('active');
}

// Utility functions
function formatDate(dateString) {
const date = new Date(dateString);
return date.toLocaleDateString('en-US', {
year: 'numeric',
month: 'short',
day: 'numeric'
});
}

function getGradeLabel(score) {
if (score >= 90) return 'Excellent';
if (score >= 80) return 'Very Good';
if (score >= 70) return 'Good';
if (score >= 60) return 'Satisfactory';
if (score >= 50) return 'Pass';
return 'Fail';
}

function debounce(func, delay) {
let timeout;
return function() {
const context = this;
const args = arguments;
clearTimeout(timeout);
timeout = setTimeout(() => func.apply(context, args), delay);
};
}

/*
// Mock data functions for demonstration
function loadMockExamData(tableBody) {
const mockExams = getMockExams();
updateExamTable(mockExams, tableBody);
}

function loadMockStudentData(tableBody) {
const mockStudents = getMockStudents();
updateStudentTable(mockStudents, tableBody);
}

function loadMockGradeData(tableBody) {
const mockGrades = getMockGrades();
updateGradeTable(mockGrades, tableBody);
}
*/

// Redirect to exam creation page
//