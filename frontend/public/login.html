<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Montserrat", sans-serif;
      }

      body {
        background-color: #c9d6ff;
        background: linear-gradient(to right, #e2e2e2, #aad7ff);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        height: 100vh;
      }

      .logo img {
        width: 185px;
      }

      .container {
        background-color: #fff;
        border-radius: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.35);
        position: relative;
        overflow: hidden;
        width: 900px; /* Increased width from 768px to 900px */
        max-width: 100%;
        min-height: 580px; /* Increased height to fit all form elements */
      }

      .container p {
        font-size: 14px;
        line-height: 20px;
        letter-spacing: 0.3px;
        margin: 20px 0;
      }

      .container h1 {
        text-align: center;
        margin-bottom: 12px;
      }

      .container a {
        color: #333;
        font-size: 13px;
        text-decoration: none;
        margin: 15px 0 10px;
      }

      .container button {
        background-color: #007bff;
        color: #fff;
        font-size: 12px;
        padding: 10px 45px;
        border: 1px solid transparent;
        border-radius: 8px;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        margin-top: 10px;
        cursor: pointer;
      }

      .container button.hidden {
        background-color: transparent;
        border-color: #fff;
      }

      .container form {
        background-color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 20px 50px; /* Increased horizontal padding from 40px to 50px */
        height: 100%;
        gap: 5px; /* Add space between form elements */
      }

      .container input {
        background-color: #eee;
        border: none;
        margin: 6px 0;
        padding: 10px 15px;
        font-size: 13px;
        border-radius: 8px;
        width: 100%;
        outline: none;
      }

      .form-container {
        position: absolute;
        top: 0;
        height: 100%;
        transition: all 0.6s ease-in-out;
      }

      .sign-in {
        left: 0;
        width: 50%;
        z-index: 2;
      }

      .container.active .sign-in {
        transform: translateX(100%);
      }

      .sign-up {
        left: 0;
        width: 50%;
        opacity: 0;
        z-index: 1;
      }

      .container.active .sign-up {
        transform: translateX(100%);
        opacity: 1;
        z-index: 5;
        animation: move 0.6s;
      }

      @keyframes move {
        0%,
        49.99% {
          opacity: 0;
          z-index: 1;
        }
        50%,
        100% {
          opacity: 1;
          z-index: 5;
        }
      }

      .toggle-container {
        position: absolute;
        top: 0;
        left: 50%;
        width: 50%;
        height: 100%;
        overflow: hidden;
        transition: all 0.6s ease-in-out;
        border-radius: 150px 0 0 100px;
        z-index: 1000;
      }

      .container.active .toggle-container {
        transform: translateX(-100%);
        border-radius: 0 150px 100px 0;
      }

      .toggle {
        background-color: #007bff;
        height: 100%;
        background: linear-gradient(to right, #007bff, #007bff);
        color: #fff;
        position: relative;
        left: -100%;
        height: 100%;
        width: 200%;
        transform: translateX(0);
        transition: all 0.6s ease-in-out;
      }

      .container.active .toggle {
        transform: translateX(50%);
      }

      .toggle-panel {
        position: absolute;
        width: 50%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 0 40px; /* Increased from 30px to 40px */
        text-align: center;
        top: 0;
        transform: translateX(0);
        transition: all 0.6s ease-in-out;
      }

      .toggle-left {
        transform: translateX(-200%);
      }

      .container.active .toggle-left {
        transform: translateX(0);
      }

      .toggle-right {
        right: 0;
        transform: translateX(0);
      }

      .container.active .toggle-right {
        transform: translateX(200%);
      }

      .sexe-checkbox {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin: 8px 0;
        background-color: #eee;
        padding: 10px 15px;
        border-radius: 8px;
      }

      .sexe-checkbox label {
        display: flex;
        align-items: center;
        font-size: 13px;
        color: #333;
        cursor: pointer;
      }

      .sexe-checkbox input[type="checkbox"] {
        margin-right: 8px;
        accent-color: #007bff;
      }
      .form-container a {
        color: #eee;
        text-decoration: none;
      }

      /* Filière dropdown styling */
      .filiere-dropdown {
        background-color: #eee;
        border: none;
        margin: 8px 0;
        padding: 10px 15px;
        font-size: 13px;
        border-radius: 8px;
        width: 100%;
        outline: none;
        color: #333;
        cursor: pointer;
      }

      .filiere-dropdown option {
        color: #333;
        background-color: #fff;
        padding: 10px;
      }

      .filiere-dropdown:focus {
        border: 1px solid #007bff;
      }
    </style>
    <title>Login page</title>
  </head>

  <body>
    <!-- HEADER -->
    <div class="headerContainer">
      <div class="header">
        <a href="/pages/login.html" class="logo">
          <img src="../src/images/logo-no-background.png" alt="logo" />
        </a>
      </div>
    </div>
    <!--  Login form  -->
    <div class="container" id="container">
      <div class="form-container sign-up">
        <form>
          <h1>Creer un nouveau Compte</h1>

          <input type="text" placeholder="Votre Nom" required />
          <input type="text" placeholder="Votre Prenom" required />
          <input type="email" placeholder="Email" required />
          <input type="password" placeholder="Mot De Passe" required />
          <input type="date" placeholder="Date de Naissance" required />
          <select id="filiere-select" class="filiere-dropdown" required>
            <option value="" disabled selected>
              Sélectionner votre filière
            </option>
            <!-- Options will be populated from backend -->
          </select>
          <div class="sexe-checkbox">
            <label
              ><input type="checkbox" name="sexe" value="Homme" /> Homme</label
            >
            <label
              ><input type="checkbox" name="sexe" value="Femme" /> Femme</label
            >
          </div>
          <button type="submit">Connexion</button>
        </form>
      </div>
      <div class="form-container sign-in">
        <form>
          <h1>Bienvenue Monsieur</h1>

          <input type="email" placeholder="Email" required />
          <input type="password" placeholder="Mot De Passe" required />
          <button type="submit">Connexion</button>
        </form>
      </div>
      <div class="toggle-container">
        <div class="toggle">
          <div class="toggle-panel toggle-left">
            <h1>Espace Ensignients</h1>
            <p>Entrer votre personalle informations</p>
            <button class="hidden" id="login">Allez A</button>
          </div>
          <div class="toggle-panel toggle-right">
            <h1>Espace Etudiant</h1>
            <p>Registre avec votre Email et mot de passe</p>
            <button class="hidden" id="register">Allez A</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const API_BASE_URL =
        window.location.hostname === "localhost"
          ? "http://localhost:5001/api"
          : "http://backend:5001/api";

      const container = document.getElementById("container");
      const registerBtn = document.getElementById("register");
      const loginBtn = document.getElementById("login");

      registerBtn.addEventListener("click", () => {
        container.classList.add("active");
      });

      loginBtn.addEventListener("click", () => {
        container.classList.remove("active");
      });

      // Helper function to show alert messages
      function showAlert(message) {
        alert(message);
      }

      // Fetch filières from backend and populate dropdown
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const filiereSelect = document.getElementById("filiere-select");

          // Only attempt to fetch filières if we're on the registration page
          if (filiereSelect) {
            const response = await fetch(`${API_BASE_URL}/filieres`);

            if (!response.ok) {
              throw new Error("Failed to fetch filières");
            }

            const filieres = await response.json();

            // Clear any existing options except the placeholder
            while (filiereSelect.options.length > 1) {
              filiereSelect.options.remove(1);
            }

            // Add new options based on fetched data
            filieres.forEach((filiere) => {
              const option = document.createElement("option");
              option.value = filiere.id || filiere._id;
              option.textContent = filiere.name;
              filiereSelect.appendChild(option);
            });
          }
        } catch (error) {
          console.error("Error fetching filières:", error);
        }
      });

      // Handle registration form submission
      const registerForm = document.querySelector(
        ".form-container.sign-up form"
      );
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const nom = registerForm
          .querySelector('input[placeholder="Votre Nom"]')
          .value.trim();
        const prenom = registerForm
          .querySelector('input[placeholder="Votre Prenom"]')
          .value.trim();
        const email = registerForm
          .querySelector('input[placeholder="Email"]')
          .value.trim();
        const password = registerForm.querySelector(
          'input[placeholder="Mot De Passe"]'
        ).value;
        const dateNaissance =
          registerForm.querySelector('input[type="date"]').value;
        const filiereId = registerForm.querySelector("#filiere-select").value;

        // Get selected gender
        const sexeOptions = registerForm.querySelectorAll(
          'input[name="sexe"]:checked'
        );
        const sexe = sexeOptions.length > 0 ? sexeOptions[0].value : null;

        if (
          !nom ||
          !prenom ||
          !email ||
          !password ||
          !dateNaissance ||
          !filiereId ||
          !sexe
        ) {
          showAlert("Please fill in all registration fields.");
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/auth/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              nom,
              prenom,
              email,
              password,
              dateNaissance,
              sexe,
              filiereId,
              role: "student",
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            showAlert(
              "Registration failed: " + (errorData.message || "Unknown error")
            );
            return;
          }

          showAlert("Registration successful! Please log in.");
          container.classList.remove("active"); // Switch to login form
        } catch (error) {
          showAlert("Registration error: " + error.message);
        }
      });

      // Handle login form submission
      const loginForm = document.querySelector(".form-container.sign-in form");
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = loginForm
          .querySelector('input[placeholder="Email"]')
          .value.trim();
        const password = loginForm.querySelector(
          'input[placeholder="Mot De Passe"]'
        ).value;

        if (!email || !password) {
          showAlert("Please enter email and password.");
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            showAlert(`Login failed: ${errorData.message || "Unknown error"}`);
            return;
          }

          const userData = await response.json();

          // Store user data in sessionStorage
          sessionStorage.setItem("user", JSON.stringify(userData));

          // Redirect based on role
          if (userData.user.role === "student") {
            window.location.href = "/StudentDashboard.html";
          } else if (userData.user.role === "professor") {
            window.location.href = "/teacher-dashboard.html";
          } else {
            showAlert("Unknown user role. Cannot redirect.");
          }
        } catch (error) {
          showAlert("Login error: " + error.message);
        }
      });
    </script>
  </body>
</html>
``` 
